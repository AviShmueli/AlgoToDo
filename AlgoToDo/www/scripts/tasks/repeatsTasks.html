<div ng-controller="repeatsTasksCtrl as vm" layout="column" class="relative" layout-fill role="main">
    <md-toolbar class="task-toolbar">
        <div class="md-toolbar-tools">
            <md-button class="md-icon-button" ng-click="vm.showGridBottomSheet()" aria-label="Menu">
                <ng-md-icon icon="{{vm.selectedViewMode.icon}}"></ng-md-icon>
            </md-button>
            <span flex></span>
            <h2>
                <span class="color-white">משימות חוזרות</span>
            </h2>
            <md-button class="md-icon-button" ng-click="vm.goBack()" aria-label="Menu">
                <ng-md-icon icon="arrow_forward"></ng-md-icon>
            </md-button>
        </div>
    </md-toolbar>

    <md-fab-trigger>
        <md-button class="md-fab md-icon-button md-fab-bottom-left z-index-21" aria-label="Add" ng-click="vm.showAdd($event)" md-no-ink="true">
            <ng-md-icon icon="add"></ng-md-icon>
        </md-button>
    </md-fab-trigger>

    <md-content flex md-scroll-y class="height-100P">
        <main flex>
            <ui-view layout="column" layout-fill flex>

                <script id="customMonthCell.html" type="text/ng-template">
                    <div class="cal-month-day {{day.cssClass}}" dir="rtl">

                        <span class="pull-right" data-cal-date ng-click="vm.calendarCtrl.dateClicked(day.date)" ng-bind="day.label">
                        </span>

                        <small style="position: absolute; bottom: 10px; left: 5px" ng-if="day.events.length > 1">
                            {{day.events.length}} משימות
                        </small>
                        <small style="position: absolute; bottom: 10px; left: 5px" ng-if="day.events.length == 1">
                            משימה אחת
                        </small>

                    </div>
                </script>
                
                <div layout="row" layout-align="space-around center">

                    <div layout="column">
                        <md-button class="md-icon-button md-accent" aria-label="Favorite" mwl-date-modifier date="vm.viewDate" decrement="vm.selectedViewMode.modeText">
                                <ng-md-icon icon="navigate_before"></md-icon>
                        </md-button>
                    </div>
                    <div layout="column">
                        <h2 class="text-center" ng-if="vm.selectedViewMode.mode !== 7">{{ vm.calendarTitle }}</h2>
                        <h2 class="text-center" ng-if="vm.selectedViewMode.mode === 7">{{ vm.viewDate | getWeekTitle : 'ds' }}</h2>
                    </div>
                    <div layout="column">
                        <md-button class="md-icon-button md-accent" aria-label="Favorite" mwl-date-modifier date="vm.viewDate" increment="vm.selectedViewMode.modeText">
                                <ng-md-icon icon="navigate_next"></md-icon>
                        </md-button>
                    </div>
                </div>
                <mwl-calendar 
                    events="vm.events" 
                    view-title="vm.calendarTitle" 
                    view="vm.selectedViewMode.modeText" 
                    view-date="vm.viewDate"
                    cell-is-open="vm.cellIsOpen"
                    day-view-start="05:00"
                    day-view-end="23:59"
                    day-view-split="15"                    
                    on-event-click="vm.eventClicked(calendarEvent)"    
                    on-event-times-changed="vm.eventTimesChanged(calendarEvent); calendarEvent.startsAt = calendarNewEventStart; calendarEvent.endsAt = calendarNewEventEnd"                    
                    custom-template-urls="{calendarMonthCell: 'customMonthCell.html'}" 
                    cell-modifier="vm.cellModifier(calendarCell)"
                    on-timespan-click="vm.timespanClicked(calendarDate, calendarCell)"
                </mwl-calendar>

                <!-- <div aria-labelledby="all" layout="row" layout-align="center center">

                    <md-list flex flex-gt-sm="50" flex-md="66" dir="rtl" ng-show="vm.repeatsTasks.length > 0">
                        <md-list-item ng-repeat="task in vm.repeatsTasks" class="noright task-item margin margin-top-7px">
                            <md-card-avatar>

                                <img ng-if="task.to.length > 1" alt="avatar" ng-src="{{vm.imagesPath + '/images/group-1.svg'}}" class="md-avatar user-avatar margin-right-10px"
                                />
                                <img ng-if="task.to.length === 1 && (task.to[0].avatarUrl.startsWith('content') || task.to[0].avatarUrl.startsWith('file'))"
                                    alt="{{task.to[0].name}}" ng-src="{{task.to[0].avatarUrl}}" class="md-avatar user-avatar margin-right-10px"
                                />
                                <img ng-if="task.to.length === 1 && !task.to[0].avatarUrl.startsWith('content')  && !task.to[0].avatarUrl.startsWith('file')"
                                    alt="{{task.to[0].name}}" ng-src="{{vm.imagesPath + task.to[0].avatarUrl}}" class="md-avatar user-avatar margin-right-10px"
                                />

                            </md-card-avatar>
                            <a class="md-tile-content margin-bottom-14px" flex="100" ng-click="vm.navigateToTaskPage(item._id)">
                                <div layout="row">
                                    <span class="from">{{(task.to.length === 1 ? task.to[0].name : (task.to[0].name + ' +' + (task.to.length - 1)))}}</span>
                                    <span flex></span>
                                    <span class="font-bold">{{vm.getRepeatedTime(task)}}</span>
                                </div>

                                <div layout="row">
                                    <div layout="row" flex="90" class="font-14px margin-left-15px">
                                        <span ng-if="task.description.length > vm.descriptionTextLength()">{{task.description.substring(0, vm.descriptionTextLength()) + '...'}}</span>
                                        <span ng-if="task.description.length <= vm.descriptionTextLength()">{{task.description}}</span>
                                    </div>
                                    <div layout="column" flex="10" layout-align="center end">
                                        <md-badge class="new-responses-badge-inProcess" ng-if="task.unSeenResponses > 0">{{item.unSeenResponses}}</md-badge>

                                        <md-button class="md-fab md-mini md-icon-button background-color-orange-hard" ng-click="vm.editTask(task, $event)" aria-label="done">
                                            <ng-md-icon icon="edit"></ng-md-icon>
                                        </md-button>
                                    </div>
                                </div>
                            </a>
                            <md-divider md-inset ng-if="!$last"></md-divider>
                        </md-list-item>
                        <md-divider></md-divider>
                    </md-list>
                    <md-list dir="rtl" ng-hide="vm.repeatsTasks.length > 0">
                        <md-item>
                            <md-item-content>
                                <h3 class="text-align-center"> עוד לא יצרת משימות חוזרות </h3>
                                <h4> לחץ על כפתור + בכדי ליצור משימה חוזרת </h4>
                            </md-item-content>
                        </md-item>
                        <md-divider></md-divider>
                    </md-list>
                </div> -->
            </ui-view>
        </main>
    </md-content>

</div>