<!DOCTYPE html>
<html ng-app="TaskManeger" class="hight-auto">
<head>
    <!--
        Customize the content security policy in the meta tag below as needed. Add 'unsafe-inline' to default-src to enable inline JavaScript.
        For details, see http://go.microsoft.com/fwlink/?LinkID=617521
    -->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost:5001">-->

    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    
    <link href="css/angular-material.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title>AlgoToDo</title>

</head>
<body layout="row" ng-controller="TaskManegerCtrl as vm" ng-cloak>
    
    <!--<div layout-fill>
        <span ng-include="'scripts/layout/layout.html'"></span>
    </div>
    <span layout="column " ng-include="'scripts/layout/sideNav.html'"></span>-->

    <div layout="column" class="relative" layout-fill role="main" >
        
        <div ng-show="vm.userConnected">
            <md-toolbar ng-show="!vm.showSearch">
                <div class="md-toolbar-tools">
                    <!--<md-button aria-label="Open Settings" ng-click="vm.showListBottomSheet($event)">
                        <ng-md-icon icon="more_vert"></ng-md-icon>
                    </md-button>-->
                    <md-button class="md-icon-button" aria-label="Search" ng-click="vm.showSearch = !vm.showSearch">
                        <ng-md-icon icon="search"></ng-md-icon>
                    </md-button>
                    <span flex></span>
                    <h2>
                        <span style="color:white">ניהול משימות</span>
                    </h2>
                    <!--<span flex="10"></span>-->
                    <md-button class="md-icon-button" ng-click="vm.toggleSidenav('left')" aria-label="Menu">
                        <ng-md-icon icon="menu"></ng-md-icon>
                    </md-button>
                </div>
                <md-tabs md-stretch-tabs="always" class="md-primary main-tabs" md-selected="vm.selectedIndex" md-swipe-content="true">
                    <md-tab id="tab1" aria-controls="tab1-content">
                        <ng-md-icon icon="assignment"></ng-md-icon>
                        <br /><span style="font-size: 10px">בתהליך</span>
                    </md-tab>
                    <md-tab id="tab2" aria-controls="tab2-content">
                        <ng-md-icon icon="assignment_ind"></ng-md-icon>
                        <br />
                        <md-badge ng-if="vm.myTasksCount > 0">{{vm.myTasksCount}}</md-badge>
                        <span style="font-size: 10px">המשימות שלי</span>
                    </md-tab>
                    <md-tab id="tab3" aria-controls="tab3-content">
                        <ng-md-icon icon="done_all"></ng-md-icon>
                        <br /><span style="font-size: 10px">בוצע</span>
                    </md-tab>
                </md-tabs>
            </md-toolbar>
            <md-toolbar class="md-hue-1" ng-show="vm.showSearch">
                <div class="md-toolbar-tools">
                    <md-button class="md-icon-button" ng-click="vm.showSearch = !vm.showSearch;vm.search = ''" aria-label="Back">
                        <ng-md-icon icon="arrow_back"></ng-md-icon>
                    </md-button>
                    <md-input-container dir="rtl" flex>
                        <input type="search" ng-model="vm.search" placeholder="חפש..." ng-keypress="vm.searchKeypress($event)">
                    </md-input-container>
                    <md-button class="md-icon-button" aria-label="Search" ng-click="vm.showSearch = !vm.showSearch">
                        <ng-md-icon icon="search"></ng-md-icon>
                    </md-button>
                    <!--<md-button aria-label="Open Settings" ng-click="vm.showListBottomSheet($event)">
                        <ng-md-icon icon="more_vert"></ng-md-icon>
                    </md-button>-->
                </div>
            </md-toolbar>
        </div>
        <md-fab-trigger>
            <md-button style="z-index: 21" class="md-fab md-fab-bottom-right" aria-label="Add" ng-click="vm.showAdd($event)" ng-if="vm.userConnected" md-no-ink="true">
                <ng-md-icon class="add-icon" icon="add"></ng-md-icon>
            </md-button>
        </md-fab-trigger>
        <md-content flex md-scroll-y ng-show="vm.userConnected" im-pull-to-refresh refresh-function="vm.reloadTasks()">  
            <ui-view layout="column" layout-fill>
                <!--<div class="inset" hide-sm></div>-->
                <ng-switch on="vm.selectedIndex" class="tabpanel-container">
                    <!-- md-swipe-down="vm.reloadTasks()" -->
                    <div role="tabpanel"
                         id="tab1-content"
                         aria-labelledby="tab1"
                         ng-switch-when="0"
                         md-swipe-left="vm.selectedIndex = 1"
                         layout="row" layout-align="center center">              
                           <md-list flex flex-gt-sm="50" flex-md="66" dir="rtl" ng-show="(vm.onGoingActivityies() | tasksInProgress: vm.user._id).length > 0">
                                <md-list-item ng-repeat="item in vm.onGoingActivityies() | tasksInProgress: vm.user._id | filter:vm.search" class="noright task-item" style="margin-top: 7px">
                                    <md-card-avatar>
                                        <img alt="{{item.to.name}}" ng-src="{{vm.appDomain + item.to.avatarUrl}}" class="md-avatar user-avatar" style="margin-right: 0;" />
                                    </md-card-avatar>
                                    <div class="md-tile-content" flex="100" style="margin-bottom: 14px;">
                                        <div layout="row">
                                            <span class="from">{{item.to.name}}</span>
                                            <!--<ng-md-icon class="head-icon" icon="send" style="fill: black" size="10"></ng-md-icon>-->
                                            <span flex></span>
                                            <span ng-bind-html="(item.createTime | amCalendar)"></span>
                                        </div>
                                        <div layout="row" style="font-size: 14px">
                                            {{item.description}}
                                        </div>
                                    </div>
                                    <md-divider md-inset ng-if="!$last"></md-divider>
                                </md-list-item>
                                <md-divider></md-divider>
                            </md-list>
                           <md-list dir="rtl" ng-hide="(vm.onGoingActivityies() | tasksInProgress: vm.user._id).length > 0">
                                <md-item>
                                    <md-item-content>
                                        <h3> אין משימות פתוחות כרגע! </h3>
                                    </md-item-content>
                                </md-item>
                                <md-divider></md-divider>
                            </md-list>
                    </div>
                    <div role="tabpanel"
                         id="tab2-content"
                         aria-labelledby="tab2"
                         ng-switch-when="1"
                         md-swipe-left="vm.selectedIndex = 2"
                         md-swipe-right="vm.selectedIndex = 0"
                         layout="row" layout-align="center center">
                           <md-list flex-gt-sm="50" flex-md="66" flex dir="rtl" ng-show="vm.myTasksCount > 0">
                                <md-list-item ng-repeat="item in vm.onGoingActivityies() | myTasks: vm.user._id | filter:vm.search" class="noright task-item" style="margin-top: 7px">
                                    <md-card-avatar>
                                        <img alt="{{item.from.name}}" ng-src="{{vm.appDomain + item.from.avatarUrl}}" class="md-avatar user-avatar" style="margin-right: 0;" />
                                    </md-card-avatar>
                                    <div class="md-tile-content" flex="100" style="margin-bottom: 14px;">
                                        <div layout="row">
                                            <span class="from">{{item.from.name}}</span>
                                            <!--<ng-md-icon class="head-icon" icon="send" style="fill: black" size="10"></ng-md-icon>-->
                                            <span flex></span>
                                            <span ng-bind-html="(item.createTime | amCalendar)"></span>
                                        </div>
                                        <div layout="row" style="font-size: 14px;">
                                            {{item.description}}
                                        </div>
                                    </div>
                                    <md-button class="md-fab md-mini md-icon-button md-secondary" style="background-color: rgba(105, 178, 137, 0.95);" ng-click="vm.setTaskStatus(item, 'done')" aria-label="done">
                                        <ng-md-icon icon="done"></ng-md-icon>
                                    </md-button>
                                    <md-divider md-inset ng-if="!$last"></md-divider>
                                </md-list-item>
                               <md-divider></md-divider>
                               </md-list>
                               <md-list dir="rtl" ng-hide="vm.myTasksCount > 0">
                                   <md-item >
                                       <md-item-content>
                                           <h3> אין משימות פתוחות כרגע! </h3>
                                       </md-item-content>
                                   </md-item>
                                   <md-divider></md-divider>
                               </md-list>
                    </div>
                    <div role="tabpanel"
                         id="tab3-content"
                         aria-labelledby="tab3"
                         ng-switch-when="2"
                         md-swipe-right="vm.selectedIndex = 1"
                         layout="row" layout-align="center center">
                           <md-list flex-gt-sm="50" flex-md="66" flex dir="rtl">
                                    <md-list-item ng-repeat="item in vm.onGoingActivityies() | filter:{ status: 'done', 'from._id': vm.user._id} | filter:vm.search | orderBy: 'doneTime':true" class="noright task-item" style="margin-top: 7px">
                                        <div class="md-tile-content" flex="100" style="margin-bottom: 14px;">
                                            <div layout="row">
                                                <span class="from">{{item.to.name}}</span>
                                                <!--<ng-md-icon class="head-icon" icon="send" style="fill: black" size="10"></ng-md-icon>-->
                                                <span flex></span>                                                
                                                <span class="time">{{vm.getTotalTaskTime(item)}}</span>
                                                <ng-md-icon icon="timer" size="20"></ng-md-icon>
                                            </div>
                                            <div layout="row">                                              
                                                <span style="font-size: 14px;">{{item.description}}</span>
                                                <!--<span flex></span>
                                                <span class="time">{{item.doneTime | date:'HH:mm'}}</span>
                                                <ng-md-icon icon="timer_off" size="20"></ng-md-icon>-->
                                            </div>
                                        </div>
                                        <md-divider ng-if="!$last"></md-divider>
                                    </md-list-item>
                               <md-divider></md-divider>
                                </md-list>
                    </div>
                </ng-switch>
            </ui-view>
        </md-content>
        
        <div tm-sign-up user="vm.user" sign-up="vm.signUp()" ng-if="!vm.userConnected"></div>
        </div>

    <div tm-sidenav user="vm.user" app-domain="vm.appDomain" log-off="vm.logOff()"></div>

    <script src="scripts/lib/angular.min.js"></script>
    <script src="scripts/lib/angular-animate.min.js"></script>
    <script src="scripts/lib/angular-sanitize.min.js"></script>
    <script src="scripts/lib/angular-aria.min.js"></script>
    <script src="scripts/lib/angular-material.min.js"></script>
    <script src="scripts/lib/angular-material-icons.min.js"></script>
    <script src="scripts/lib/ng-lodash.min.js"></script>
    <script src="scripts/lib/ngStorage.min.js"></script>
    <script src="scripts/lib/angular-cookies.min.js"></script>
    <script src="scripts/lib/angular-messages.min.js"></script>
    <script src="scripts/lib/angular-md-pull-to-refresh.js"></script>

    <script src="scripts/lib/angular-loggly-logger.min.js"></script>
    
    <script src="scripts/lib/moment.js"></script>
    <script src="scripts/lib/he.js"></script>
    <script src="scripts/lib/angular-moment.min.js"></script>
    
    <script type="text/javascript" src="scripts/lib/ng-cordova.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="scripts/platformOverrides.js"></script>
    <script type="text/javascript" src="scripts/index.js"></script>

    <script src="https://algotodo.herokuapp.com/socket.io/socket.io.js "></script>
    <!--<script src="http://localhost:5001/socket.io/socket.io.js "></script>-->

    <script src="scripts/TaskManeger/TaskManeger.module.js "></script>
    <script src="scripts/core/core.module.js "></script>
    <script src="scripts/widgets/widgets-module.js "></script>
    <script src="scripts/data/data.module.js "></script>
    <script src="scripts/logger/logger.module.js "></script>
    <script src="scripts/cordova/cordova.module.js"></script>
    <script src="scripts/logger/logger.js "></script>
    <script src="scripts/data/datacontext.js "></script>
    <script src="scripts/data/socket.js "></script>
    <script src="scripts/core/config.js "></script>
    <script src="scripts/widgets/AddTaskDialog.js "></script>
    <script src="scripts/widgets/ListBottomSheet.js "></script>
    <script src="scripts/widgets/userAvater.js "></script>
    <script src="scripts/TaskManeger/TaskManeger.js "></script>
    <script src="scripts/core/filters.js"></script>
    <script src="scripts/cordova/cordovaPlugins.js"></script>
    <script src="scripts/widgets/sidenav.js"></script>
    <script src="scripts/widgets/signUp.js"></script>
</body>
</html>
